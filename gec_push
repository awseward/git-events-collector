#!/usr/bin/env bash

set -euo pipefail

readonly filepath="$1"
readonly filename="$(basename "${filepath}")"
readonly sj_prefix="${2:-sj://dw-inbox/git-events}"

echo 'dw-write' \
  | xargs -t uplink cp "${filepath}" "${sj_prefix}/${filename}" --progress=false --expires="$(date -d '10 days' -u +%FT%TZ)" --access \
  | sed -E 's/^Created //' \
  && ( echo "${filepath}" | xargs -t >&2 rm -fv -- ) # Remove the temp file if it made it up.
