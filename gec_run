#!/usr/bin/env bash

set -euo pipefail

echo -en "\n=== " && date

readonly sqlite_file="$(gec_rotate | xargs -t gec_tsv-to-sqlite)"
[ "${sqlite_file}" == '' ] && exit 1

readonly sj_prefix='sj://dw-inbox/git-events'
readonly sj_path="$(
  echo "${sqlite_file}" | xargs -t -I{} dw_push_sqlite {} "${sj_prefix}"
)"
[ "${sj_path}" == '' ] && exit 1

echo "${sj_path}" | xargs -t dw_signal_sqlite 'git-events'
